library(arrow)
library(tidyverse)
#download.file('https://storage.yandexcloud.net/arrow-datasets/tm_data.pqt', destfile = "tm_data.pqt")
df <- arrow::open_dataset(sources = "data/tm_data.pqt", format = "parquet")
library(arrow)
library(tidyverse)
#download.file('https://storage.yandexcloud.net/arrow-datasets/tm_data.pqt', destfile = "tm_data.pqt")
df <- pd.read_rarquet("data/tm_data.pqt", engine = 'fastparquet')
library(arrow)
library(tidyverse)
#download.file('https://storage.yandexcloud.net/arrow-datasets/tm_data.pqt', destfile = "tm_data.pqt")
df <- pd.read_parquet("data/tm_data.pqt", engine = 'fastparquet')
library(arrow)
library(tidyverse)
#download.file('https://storage.yandexcloud.net/arrow-datasets/tm_data.pqt', destfile = "tm_data.pqt")
df <- read_parquet("data/tm_data.pqt", engine = 'fastparquet')
library(arrow)
library(tidyverse)
#download.file('https://storage.yandexcloud.net/arrow-datasets/tm_data.pqt', destfile = "tm_data.pqt")
df <- read_parquet("data/tm_data.pqt", use_threads = False)
library(arrow)
library(tidyverse)
#download.file('https://storage.yandexcloud.net/arrow-datasets/tm_data.pqt', destfile = "tm_data.pqt")
read_parquet("data/tm_data.parquet")
library(arrow)
library(tidyverse)
#download.file('https://storage.yandexcloud.net/arrow-datasets/tm_data.pqt', destfile = "tm_data.pqt")
read_parquet("data/tm_data.pqt")
library(arrow)
library(tidyverse)
#download.file('https://storage.yandexcloud.net/arrow-datasets/tm_data.pqt', destfile = "tm_data.pqt")
read_parquet("data/tm_data1.pqt")
library(arrow)
library(tidyverse)
download.file('https://storage.yandexcloud.net/arrow-datasets/tm_data.pqt', destfile = "tm_data123.pqt")
--timeout 10000
options(timeout = max(1000, getOption("timeout")))
library(arrow)
library(tidyverse)
download.file('https://storage.yandexcloud.net/arrow-datasets/tm_data.pqt', destfile = "tm_data123.pqt")
library(arrow)
library(tidyverse)
download.file('https://storage.yandexcloud.net/arrow-datasets/tm_data.pqt', destfile = "tm_data123.pqt")
options(timeout = max(10000, getOption("timeout")))
library(arrow)
library(tidyverse)
download.file('https://storage.yandexcloud.net/arrow-datasets/tm_data.pqt', destfile = "tm_data321.pqt")
#df <- read_parquet("data/tm_data1.pqt", use_threads = False)
#glimpse(df)
library(arrow)
library(tidyverse)
#download.file('https://storage.yandexcloud.net/arrow-datasets/tm_data.pqt', destfile = "tm_data321.pqt")
df <- read_parquet("data/tm_data1.pqt", use_threads = False)
library(arrow)
library(tidyverse)
#download.file('https://storage.yandexcloud.net/arrow-datasets/tm_data.pqt', destfile = "tm_data321.pqt")
df <- read_parquet("tm_data321.pqt", use_threads = False)
library(arrow)
library(tidyverse)
#download.file('https://storage.yandexcloud.net/arrow-datasets/tm_data.pqt', destfile = "tm_data.pqt")
df <- read_parquet("tm_data.pqt", use_threads = FALSE)
glimpse(df)
gc()
library(arrow)
library(tidyverse)
#download.file('https://storage.yandexcloud.net/arrow-datasets/tm_data.pqt', destfile = "tm_data.pqt")
df <- read_parquet("tm_data.pqt", use_threads = FALSE)
ff <- df%>%filter(str_detect(src, "^12.") | str_detect(src, "^13.") | str_detect(src, "^14."))%>%
filter(!str_detect(dst, "^12.") | !str_detect(dst, "^13.") | !str_detect(dst, "^14."))  %>%
group_by(src) %>% summarise("sum" = sum(bytes)) %>% select(src,sum)
memory.limit(size = 6000)
ff <- df%>%filter(grepl("^12.|^13.|^14.", src) & !grepl("^12.|^13.|^14.", dst))%>%group_by(src) %>% summarise("sum" = sum(bytes)) %>% select(src,sum)
#ff <- df%>%filter(grepl("^12.|^13.|^14.", src) & !grepl("^12.|^13.|^14.", dst))%>%group_by(src) %>% summarise("sum" = sum(bytes)) %>% select(src,sum)
glimpse(ff)
#ff <- df%>%filter(grepl("^12.|^13.|^14.", src) & !grepl("^12.|^13.|^14.", dst))%>%group_by(src) %>% summarise("sum" = sum(bytes)) %>% select(src,sum)
ff1 <- ff%>%filter(sum>6000000000)
glimpse(ff1)
z2 <- df%>%select(timestamp, src, dst, bytes)%>%mutate(trafic=grepl("^12.|^13.|^14.", src) & !grepl("^12.|^13.|^14.", dst),time=hour(as_datetime(timestamp/1000))) %>%filter(trafic==TRUE,time>=0&time<=24)%>% group_by(time)%>%summarise(trafictime = n())%>%arrange(desc(trafictime))
glimpse(z2)
#z2 <- df%>%select(timestamp, src, dst, bytes)%>%mutate(trafic=grepl("^12.|^13.|^14.", src) & !grepl("^12.|^13.|^14.", dst),time=hour(as_datetime(timestamp/1000))) %>%filter(trafic==TRUE,time>=0&time<=24)%>% group_by(time)%>%summarise(trafictime = n())%>%arrange(desc(trafictime))
z2 <- group_by(time)
#z2 <- df%>%select(timestamp, src, dst, bytes)%>%mutate(trafic=grepl("^12.|^13.|^14.", src) & !grepl("^12.|^13.|^14.", dst),time=hour(as_datetime(timestamp/1000))) %>%filter(trafic==TRUE,time>=0&time<=24)%>% group_by(time)%>%summarise(trafictime = n())%>%arrange(desc(trafictime))
glimpse(z2)
nz2 <- df%>%mutate(time=hour(as_datetime(timestamp/1000)))%>%filter(grepl("^12.|^13.|^14.", src)&!grepl("^12.|^13.|^14.", dst))%>%filter(!str_detect(src, "^13.37.84.125"))%>%filter(time>=1&time<=15)%>%group_by(src)%>%summarise("sum" =sum(bytes))%>%select(src,sum)
#nz2 <- df%>%mutate(time=hour(as_datetime(timestamp/1000)))%>%filter(grepl("^12.|^13.|^14.", src)&!grepl("^12.|^13.|^14.", dst))%>%filter(!str_detect(src, "^13.37.84.125"))%>%filter(time>=1&time<=15)%>%group_by(src)%>%summarise("sum" =sum(bytes))%>%select(src,sum)
glimpse(nz2)
#nz2 <- df%>%mutate(time=hour(as_datetime(timestamp/1000)))%>%filter(grepl("^12.|^13.|^14.", src)&!grepl("^12.|^13.|^14.", dst))%>%filter(!str_detect(src, "^13.37.84.125"))%>%filter(time>=1&time<=15)%>%group_by(src)%>%summarise("sum" =sum(bytes))%>%select(src,sum)
nz3 <- group_by('sum')
#nz2 <- df%>%mutate(time=hour(as_datetime(timestamp/1000)))%>%filter(grepl("^12.|^13.|^14.", src)&!grepl("^12.|^13.|^14.", dst))%>%filter(!str_detect(src, "^13.37.84.125"))%>%filter(time>=1&time<=15)%>%group_by(src)%>%summarise("sum" =sum(bytes))%>%select(src,sum)
nz3 <- group_by(sum)
#nz2 <- df%>%mutate(time=hour(as_datetime(timestamp/1000)))%>%filter(grepl("^12.|^13.|^14.", src)&!grepl("^12.|^13.|^14.", dst))%>%filter(!str_detect(src, "^13.37.84.125"))%>%filter(time>=1&time<=15)%>%group_by(src)%>%summarise("sum" =sum(bytes))%>%select(src,sum)
nz2 <- nz2%>%filter(sum>290000000)
glimpse(nz2)
#nz2 <- df%>%mutate(time=hour(as_datetime(timestamp/1000)))%>%filter(grepl("^12.|^13.|^14.", src)&!grepl("^12.|^13.|^14.", dst))%>%filter(!str_detect(src, "^13.37.84.125"))%>%filter(time>=1&time<=15)%>%group_by(src)%>%summarise("sum" =sum(bytes))%>%select(src,sum)
nz2 <- nz2%>%filter(sum>200000000)
glimpse(nz2)
#nz2 <- df%>%mutate(time=hour(as_datetime(timestamp/1000)))%>%filter(grepl("^12.|^13.|^14.", src)&!grepl("^12.|^13.|^14.", dst))%>%filter(!str_detect(src, "^13.37.84.125"))%>%filter(time>=1&time<=15)%>%group_by(src)%>%summarise("sum" =sum(bytes))%>%select(src,sum)
nz2 <- nz2%>%filter(sum>100000000)
glimpse(nz2)
nz2 <- df%>%mutate(time=hour(as_datetime(timestamp/1000)))%>%filter(grepl("^12.|^13.|^14.", src)&!grepl("^12.|^13.|^14.", dst))%>%filter(!str_detect(src, "^13.37.84.125"))%>%filter(time>=1&time<=15)%>%group_by(src)%>%summarise("sum" =sum(bytes))%>%filter(sum>290000000)%>%select(src,sum)
glimpse(nz2)
nz2 <- df%>%mutate(time=hour(as_datetime(timestamp/1000)))%>% filter(!str_detect(src, "^13.37.84.125")) %>%
filter(str_detect(src, "^12.") | str_detect(src, "^13.") | str_detect(src, "^14."))  %>%
filter(!str_detect(dst, "^12.") | !str_detect(dst, "^13.") | !str_detect(dst, "^14."))%>%filter(time>=1&time<=15)%>%group_by(src)%>%summarise("sum" =sum(bytes))%>%filter(sum>290000000)%>%select(src,sum)
gc()
nz2 <- df%>%mutate(time=hour(as_datetime(timestamp/1000)))%>% filter(!str_detect(src, "^13.37.84.125")) %>%
filter(str_detect(src, "^12.") | str_detect(src, "^13.") | str_detect(src, "^14."))  %>%
filter(!str_detect(dst, "^12.") | !str_detect(dst, "^13.") | !str_detect(dst, "^14."))%>%filter(time>=1&time<=15)%>%group_by(src)%>%summarise("sum" =sum(bytes))%>%filter(sum>290000000)%>%select(src,sum)
nz2 <- df%>%mutate(time=hour(as_datetime(timestamp/1000)))%>% filter(grepl("^12.|^13.|^14.", src) & !grepl("^12.|^13.|^14.", dst))%>%filter(time>=1&time<=15)%>%group_by(src)%>%summarise("sum" =sum(bytes))%>%filter(sum>290000000)%>%select(src,sum)
glimpse(nz2)
nz2 <- df%>%mutate(time=hour(as_datetime(timestamp/1000)))%>%filter(!str_detect(src, "^13.37.84.125"))%>% filter(grepl("^12.|^13.|^14.", src) & !grepl("^12.|^13.|^14.", dst))%>%filter(time>=1&time<=15)%>%group_by(src)%>%summarise("sum" =sum(bytes))%>%select(src,sum)
nz2 <- df%>%mutate(time=hour(as_datetime(timestamp/1000)))%>%filter(!grepl("^13.37.84.125",src))%>% filter(grepl("^12.|^13.|^14.", src) & !grepl("^12.|^13.|^14.", dst))%>%filter(time>=1&time<=15)%>%group_by(src)%>%summarise("sum" =sum(bytes))%>%select(src,sum)
glimpse(nz2)
#nz2 <- df%>%mutate(time=hour(as_datetime(timestamp/1000)))%>%filter(!grepl("^13.37.84.125",src))%>% filter(grepl("^12.|^13.|^14.", src) & !grepl("^12.|^13.|^14.", dst))%>%filter(time>=1&time<=15)%>%group_by(src)%>%summarise("sum" =sum(bytes))%>%select(src,sum)
nz22 <- nz2%>%filter(sum>290000000) %>% select(src,sum)
glimpse(nz2)
#nz2 <- df%>%mutate(time=hour(as_datetime(timestamp/1000)))%>%filter(!grepl("^13.37.84.125",src))%>% filter(grepl("^12.|^13.|^14.", src) & !grepl("^12.|^13.|^14.", dst))%>%filter(time>=1&time<=15)%>%group_by(src)%>%summarise("sum" =sum(bytes))%>%select(src,sum)
nz22 <- nz2%>%filter(grepl("^12.55.77.96",src) %>% select(src,sum))
#nz2 <- df%>%mutate(time=hour(as_datetime(timestamp/1000)))%>%filter(!grepl("^13.37.84.125",src))%>% filter(grepl("^12.|^13.|^14.", src) & !grepl("^12.|^13.|^14.", dst))%>%filter(time>=1&time<=15)%>%group_by(src)%>%summarise("sum" =sum(bytes))%>%select(src,sum)
nz22 <- nz2%>%filter(grepl("^12.55.77.96",src))
glimpse(nz2)
#nz2 <- df%>%mutate(time=hour(as_datetime(timestamp/1000)))%>%filter(!grepl("^13.37.84.125",src))%>% filter(grepl("^12.|^13.|^14.", src) & !grepl("^12.|^13.|^14.", dst))%>%filter(time>=1&time<=15)%>%group_by(src)%>%summarise("sum" =sum(bytes))%>%select(src,sum)
nz22 <- nz2%>%filter(grepl("^12.55.77.96",src))
glimpse(nz22)
#nz2 <- df%>%mutate(time=hour(as_datetime(timestamp/1000)))%>%filter(!grepl("^13.37.84.125",src))%>% filter(grepl("^12.|^13.|^14.", src) & !grepl("^12.|^13.|^14.", dst))%>%filter(time>=1&time<=15)%>%group_by(src)%>%summarise("sum" =sum(bytes))%>%select(src,sum)
nz22 <- nz2%>%filter(sum>286000000)
glimpse(nz22)
task31 <- df %>% filter(!grepl("^13.37.84.125",src)& !grepl("^12.55.77.96",src))%>% select(src, bytes, port)
task31 %>%  group_by(port) %>% summarise("mean"=mean(bytes), "max"=max(bytes), "sum" = sum(bytes)) %>%
mutate("Raz"= max-mean)  %>% filter(Raz!=0, Raz>170000) %>% collect()
#z3 <- df %>% filter(!grepl("^13.37.84.125",src)& !grepl("^12.55.77.96",src))%>% select(src, bytes, port)
#z33 %>%  group_by(port) %>% summarise("mean"=mean(bytes), "max"=max(bytes), "sum" = sum(bytes)) %>%
mutate("Raz"= max-mean)  %>% filter(Raz!=0, Raz>170000)
#z3 <- df %>% filter(!grepl("^13.37.84.125",src)& !grepl("^12.55.77.96",src))%>% select(src, bytes, port)
#z33 <- z3%>%group_by(port)%>%summarise("mean"=mean(bytes),"max"=max(bytes),"sum"=sum(bytes))%>%mutate("Raz"= max-mean)%>%filter(Raz!=0, Raz>170000)
z333 <- z33%>%filter(port==37)%>%group_by(src)%>%summarise("mean"=mean(bytes))%>%filter(mean>37543)%>%select(src)
#z3 <- df %>% filter(!grepl("^13.37.84.125",src)& !grepl("^12.55.77.96",src))%>% select(src, bytes, port)
z33 <- z3%>%group_by(port)%>%summarise("mean"=mean(bytes),"max"=max(bytes),"sum"=sum(bytes))%>%mutate("Raz"= max-mean)%>%filter(Raz!=0, Raz>170000)
z3 <- df %>% filter(!grepl("^13.37.84.125",src)& !grepl("^12.55.77.96",src))%>% select(src, bytes, port)
z33 <- z3%>%group_by(port)%>%summarise("mean"=mean(bytes),"max"=max(bytes),"sum"=sum(bytes))%>%mutate("Raz"= max-mean)%>%filter(Raz!=0, Raz>170000)
z333 <- z33%>%filter(port==37)%>%group_by(src)%>%summarise("mean"=mean(bytes))%>%filter(mean>37543)%>%select(src)
#z3 <- df %>% filter(!grepl("^13.37.84.125",src)& !grepl("^12.55.77.96",src))%>% select(src, bytes, port)
#z33 <- z3%>%group_by(port)%>%summarise("mean"=mean(bytes),"max"=max(bytes),"sum"=sum(bytes))%>%mutate("Raz"= max-mean)%>%filter(Raz!=0, Raz>170000)
z333 <- z33%>%filter(port==37)%>%group_by(src)%>%summarise("mean"=mean(bytes))%>%filter(mean>37543)
#z3 <- df %>% filter(!grepl("^13.37.84.125",src)& !grepl("^12.55.77.96",src))%>% select(src, bytes, port)
#z33 <- z3%>%group_by(port)%>%summarise("mean"=mean(bytes),"max"=max(bytes),"sum"=sum(bytes))%>%mutate("Raz"= max-mean)%>%filter(Raz!=0, Raz>170000)
z333 <- z33%>%filter(port==37)%>%summarise("mean"=mean(bytes))%>%filter(mean>37543)
#z3 <- df %>% filter(!grepl("^13.37.84.125",src)& !grepl("^12.55.77.96",src))%>% select(src, bytes, port)
#z33 <- z3%>%group_by(port)%>%summarise("mean"=mean(bytes),"max"=max(bytes),"sum"=sum(bytes))%>%mutate("Raz"= max-mean)%>%filter(Raz!=0, Raz>170000)
z333 <- z3%>%filter(port==37)%>%group_by(src)%>%summarise("mean"=mean(bytes))%>%filter(mean>37543)%>%select(src)
#z3 <- df %>% filter(!grepl("^13.37.84.125",src)& !grepl("^12.55.77.96",src))%>% select(src, bytes, port)
#z33 <- z3%>%group_by(port)%>%summarise("mean"=mean(bytes),"max"=max(bytes),"sum"=sum(bytes))%>%mutate("Raz"= max-mean)%>%filter(Raz!=0, Raz>170000)
#z333 <- z3%>%filter(port==37)%>%group_by(src)%>%summarise("mean"=mean(bytes))%>%filter(mean>37543)%>%select(src)
glimpse(z333)
gc()
gc()
